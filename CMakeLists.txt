####################################################################################################
# CMakeLists file for f0plugins
# Generated by Fredrik Olofsson
# 2021-03-28
####################################################################################################

####################################################################################################
# basic project config
cmake_minimum_required(VERSION 3.5)
set(project_name "f0plugins")
set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake_modules ${CMAKE_MODULE_PATH})
set(CMAKE_CXX_STANDARD 17)

####################################################################################################
# load modules
include(SuperColliderServerPlugin RESULT_VARIABLE server_plugin_found)
if(NOT server_plugin_found)
    message(FATAL_ERROR "Could not find server plugin functions module")
endif()

include(SuperColliderCompilerConfig RESULT_VARIABLE compiler_config_found)
if(NOT compiler_config_found)
    message(FATAL_ERROR "Could not find compiler config module")
endif()

# Windows - puts redistributable DLLs in install directory
include(InstallRequiredSystemLibraries)

sc_check_sc_path("${SC_PATH}")
message(STATUS "Found SuperCollider: ${SC_PATH}")
set(SC_PATH "${SC_PATH}" CACHE PATH
    "Path to SuperCollider source. Relative paths are treated as relative to this script" FORCE)

include("${SC_PATH}/SCVersion.txt")
message(STATUS "Building plugins for SuperCollider version: ${SC_VERSION}")

# set project here to avoid SCVersion.txt clobbering our version info
project(${project_name})
sc_do_initial_compiler_config() # do after setting project so compiler ID is available

if(CMAKE_INSTALL_PREFIX_INITIALIZED_TO_DEFAULT OR NOT CMAKE_INSTALL_PREFIX)
    message(WARNING "No install prefix provided, defaulting to $BUILD_DIR/install")
    set(CMAKE_INSTALL_PREFIX "${CMAKE_BINARY_DIR}/install" CACHE PATH "Install prefix" FORCE)
endif()

message(STATUS "Install directory set to: ${CMAKE_INSTALL_PREFIX}")

####################################################################################################
# options
option(SUPERNOVA "Build plugins for supernova" ON)
option(SCSYNTH "Build plugins for scsynth" ON)
option(NATIVE "Optimize for native architecture" OFF)
option(STRICT "Use strict warning flags" OFF)
option(NOVA_SIMD "Build plugins with nova-simd support." ON)

####################################################################################################
# include libraries

if (NOVA_SIMD)
	add_definitions(-DNOVA_SIMD)
	include_directories(${SC_PATH}/external_libraries/nova-simd)
endif()

####################################################################################################
# plugins targets

set(Astrocade_cpp_files
    plugins/Astrocade/astrocde.cpp
)
set(Astrocade_sc_files
    plugins/Astrocade/sc/Astrocade.sc
)
set(Astrocade_schelp_files
    plugins/Astrocade/sc/HelpSource/Classes/Astrocade.schelp
)
sc_add_server_plugin(
    "f0plugins/Astrocade" # destination directory
    "Astrocade" # target name
    "${Astrocade_cpp_files}"
    "${Astrocade_sc_files}"
    "${Astrocade_schelp_files}"
    ""
)

set(Atari2600_cpp_files
    plugins/Atari2600/Atari2600.cpp
)
set(Atari2600_sc_files
    plugins/Atari2600/sc/Atari2600.sc
)
set(Atari2600_schelp_files
    plugins/Atari2600/sc/HelpSource/Classes/Atari2600.schelp
)
sc_add_server_plugin(
    "f0plugins/Atari2600" # destination directory
    "Atari2600" # target name
    "${Atari2600_cpp_files}"
    "${Atari2600_sc_files}"
    "${Atari2600_schelp_files}"
    ""
)

set(AY8910_cpp_files
    plugins/AY8910/ay8910.cpp
)
set(AY8910_sc_files
    plugins/AY8910/sc/AY8910.sc
    plugins/AY8910/sc/AY8910Square.sc
)
set(AY8910_schelp_files
    plugins/AY8910/sc/HelpSource/Classes/AY8910.schelp
    plugins/AY8910/sc/HelpSource/Classes/AY8910Square.schelp
)
sc_add_server_plugin(
    "f0plugins/AY8910" # destination directory
    "AY8910" # target name
    "${AY8910_cpp_files}"
    "${AY8910_sc_files}"
    "${AY8910_schelp_files}"
    ""
)

set(Beep_cpp_files
    plugins/Beep/beep.cpp
)
set(Beep_sc_files
    plugins/Beep/sc/Beep.sc
)
set(Beep_schelp_files
    plugins/Beep/sc/HelpSource/Classes/Beep.schelp
)
sc_add_server_plugin(
    "f0plugins/Beep" # destination directory
    "Beep" # target name
    "${Beep_cpp_files}"
    "${Beep_sc_files}"
    "${Beep_schelp_files}"
    ""
)

set(MZPokey_cpp_files
    plugins/MZPokey/mzpokeysnd.cpp
    plugins/MZPokey/mzpokeysnd.h
    plugins/MZPokey/pokey.h
    plugins/MZPokey/pokeysnd.h
    plugins/MZPokey/remez.cpp
    plugins/MZPokey/remez.h
)
set(MZPokey_sc_files
    plugins/MZPokey/sc/MZPokey.sc
)
set(MZPokey_schelp_files
    plugins/MZPokey/sc/HelpSource/Classes/MZPokey.schelp
)
sc_add_server_plugin(
    "f0plugins/MZPokey" # destination directory
    "MZPokey" # target name
    "${MZPokey_cpp_files}"
    "${MZPokey_sc_files}"
    "${MZPokey_schelp_files}"
    ""
)

set(Nes2_cpp_files
    plugins/Nes2/nes_apu.cpp
    plugins/Nes2/nes_apu.h
    plugins/Nes2/types.h
)
set(Nes2_sc_files
    plugins/Nes2/sc/Nes2.sc
)
set(Nes2_schelp_files
    plugins/Nes2/sc/HelpSource/Classes/Nes2.schelp
    plugins/Nes2/sc/HelpSource/Classes/Nes2DMC.schelp
    plugins/Nes2/sc/HelpSource/Classes/Nes2Noise.schelp
    plugins/Nes2/sc/HelpSource/Classes/Nes2Square.schelp
    plugins/Nes2/sc/HelpSource/Classes/Nes2Triangle.schelp
)
sc_add_server_plugin(
    "f0plugins/Nes2" # destination directory
    "Nes2" # target name
    "${Nes2_cpp_files}"
    "${Nes2_sc_files}"
    "${Nes2_schelp_files}"
    ""
)

set(Pokey_cpp_files
    plugins/Pokey/POKEY.CPP
    plugins/Pokey/POKEY.H
)
set(Pokey_sc_files
    plugins/Pokey/sc/Pokey.sc
)
set(Pokey_schelp_files
    plugins/Pokey/sc/HelpSource/Classes/Pokey.schelp
    plugins/Pokey/sc/HelpSource/Classes/PokeySquare.schelp
)
sc_add_server_plugin(
    "f0plugins/Pokey" # destination directory
    "Pokey" # target name
    "${Pokey_cpp_files}"
    "${Pokey_sc_files}"
    "${Pokey_schelp_files}"
    ""
)

set(RedDPCM_cpp_files
    plugins/RedDPCM/RedDPCM.cpp
)
set(RedDPCM_sc_files
    plugins/RedDPCM/sc/RedDPCMdecode.sc
    plugins/RedDPCM/sc/RedDPCMencode.sc
)
set(RedDPCM_schelp_files
    plugins/RedDPCM/sc/HelpSource/Classes/RedDPCMdecode.schelp
    plugins/RedDPCM/sc/HelpSource/Classes/RedDPCMencode.schelp
)
sc_add_server_plugin(
    "f0plugins/RedDPCM" # destination directory
    "RedDPCM" # target name
    "${RedDPCM_cpp_files}"
    "${RedDPCM_sc_files}"
    "${RedDPCM_schelp_files}"
    ""
)

set(RedLbyl_cpp_files
    plugins/RedLbyl/RedLbyl.cpp
)
set(RedLbyl_sc_files
    plugins/RedLbyl/sc/RedLbyl.sc
)
set(RedLbyl_schelp_files
    plugins/RedLbyl/sc/HelpSource/Classes/RedLbyl.schelp
)
sc_add_server_plugin(
    "f0plugins/RedLbyl" # destination directory
    "RedLbyl" # target name
    "${RedLbyl_cpp_files}"
    "${RedLbyl_sc_files}"
    "${RedLbyl_schelp_files}"
    ""
)

set(RedNoise_cpp_files
    plugins/RedNoise/RedNoise.cpp
)
set(RedNoise_sc_files
    plugins/RedNoise/sc/RedNoise.sc
)
set(RedNoise_schelp_files
    plugins/RedNoise/sc/HelpSource/Classes/RedNoise.schelp
)
sc_add_server_plugin(
    "f0plugins/RedNoise" # destination directory
    "RedNoise" # target name
    "${RedNoise_cpp_files}"
    "${RedNoise_sc_files}"
    "${RedNoise_schelp_files}"
    ""
)

set(RedPhasor_cpp_files
    plugins/RedPhasor/RedPhasor.cpp
    
)
set(RedPhasor_sc_files
    plugins/RedPhasor/sc/RedPhasor.sc
    plugins/RedPhasor/sc/RedPhasor2.sc
)
set(RedPhasor_schelp_files
    plugins/RedPhasor/sc/HelpSource/Classes/RedPhasor.schelp
    plugins/RedPhasor/sc/HelpSource/Classes/RedPhasor2.schelp
)
sc_add_server_plugin(
    "f0plugins/RedPhasor" # destination directory
    "RedPhasor" # target name
    "${RedPhasor_cpp_files}"
    "${RedPhasor_sc_files}"
    "${RedPhasor_schelp_files}"
    ""
)

set(SID6581f_cpp_files
    plugins/SID6581f/sid.cpp
    plugins/SID6581f/sid.h
    plugins/SID6581f/sid6581.cpp
    plugins/SID6581f/sid6581.h
    plugins/SID6581f/side6581.h
    plugins/SID6581f/sidenvel.cpp
    plugins/SID6581f/sidenvel.h
    plugins/SID6581f/sidvoice.cpp
    plugins/SID6581f/sidvoice.h
    plugins/SID6581f/sidw6581.h
    plugins/SID6581f/sidw8580.h
)
set(SID6581f_sc_files
    plugins/SID6581f/sc/SID6581f.sc
)
set(SID6581f_schelp_files
    plugins/SID6581f/sc/HelpSource/Classes/SID6581f.schelp
)
sc_add_server_plugin(
    "f0plugins/SID6581f" # destination directory
    "SID6581f" # target name
    "${SID6581f_cpp_files}"
    "${SID6581f_sc_files}"
    "${SID6581f_schelp_files}"
    ""
)

set(Slub_cpp_files
    plugins/Slub/Slub.cpp
)
set(Slub_sc_files
    plugins/Slub/sc/Slub.sc
)
set(Slub_schelp_files
    plugins/Slub/sc/HelpSource/Classes/Slub.schelp
)
sc_add_server_plugin(
    "f0plugins/Slub" # destination directory
    "Slub" # target name
    "${Slub_cpp_files}"
    "${Slub_sc_files}"
    "${Slub_schelp_files}"
    ""
)

set(SN76489_cpp_files
    plugins/SN76489/sn76489.cpp
    plugins/SN76489/sn76489.h
)
set(SN76489_sc_files
    plugins/SN76489/sc/SN76489.sc
)
set(SN76489_schelp_files
    plugins/SN76489/sc/HelpSource/Classes/SN76489.schelp
)
sc_add_server_plugin(
    "f0plugins/SN76489" # destination directory
    "SN76489" # target name
    "${SN76489_cpp_files}"
    "${SN76489_sc_files}"
    "${SN76489_schelp_files}"
    ""
)

set(Dbjorklund_cpp_files
    plugins/Dbjorklund/Dbjorklund.cpp
)
set(Dbjorklund_sc_files
    plugins/Dbjorklund/sc/Dbjorklund.sc
)
set(Dbjorklund_sctest_files
    plugins/Dbjorklund/sc/Tests/TestDbjorklund.sc
    plugins/Dbjorklund/sc/Tests/TestDbjorklund2.sc
)
set(Dbjorklund_schelp_files
    plugins/Dbjorklund/sc/HelpSource/Classes/Dbjorklund.schelp
    plugins/Dbjorklund/sc/HelpSource/Classes/Dbjorklund2.schelp
)
sc_add_server_plugin(
    "f0plugins/Dbjorklund" # destination directory
    "Dbjorklund" # target name
    "${Dbjorklund_cpp_files}"
    "${Dbjorklund_sc_files}"
    "${Dbjorklund_schelp_files}"
    "${Dbjorklund_sctest_files}"
)

set(Tbjorklund_cpp_files
    plugins/Tbjorklund/Tbjorklund.cpp
)
set(Tbjorklund_sc_files
    plugins/Tbjorklund/sc/Tbjorklund.sc
)
set(Tbjorklund_sctest_files
    plugins/Tbjorklund/sc/Tests/TestTbjorklund.sc
)
set(Tbjorklund_schelp_files
    plugins/Tbjorklund/sc/HelpSource/Classes/Tbjorklund.schelp
)
sc_add_server_plugin(
    "f0plugins/Tbjorklund" # destination directory
    "Tbjorklund" # target name
    "${Tbjorklund_cpp_files}"
    "${Tbjorklund_sc_files}"
    "${Tbjorklund_schelp_files}"
    "${Tbjorklund_sctest_files}"
)

set(WavesetRepeater_cpp_files
    plugins/WavesetRepeater/WavesetRepeater.cpp
)
set(WavesetRepeater_sc_files
    plugins/WavesetRepeater/sc/WavesetRepeater.sc
)
set(WavesetRepeater_schelp_files
    plugins/WavesetRepeater/sc/HelpSource/Classes/WavesetRepeater.schelp
)
sc_add_server_plugin(
    "f0plugins/WavesetRepeater" # destination directory
    "WavesetRepeater" # target name
    "${WavesetRepeater_cpp_files}"
    "${WavesetRepeater_sc_files}"
    "${WavesetRepeater_schelp_files}"
    ""
)

set(Dsieve_cpp_files
    plugins/Dsieve/Dsieve.cpp
)
set(Dsieve_sc_files
    plugins/Dsieve/sc/Dsieve.sc
)
set(Dsieve_sctest_files
    plugins/Dsieve/sc/Tests/TestDsieve.sc
)
set(Dsieve_schelp_files
    plugins/Dsieve/sc/HelpSource/Classes/Dsieve.schelp
)
sc_add_server_plugin(
    "f0plugins/Dsieve" # destination directory
    "Dsieve" # target name
    "${Dsieve_cpp_files}"
    "${Dsieve_sc_files}"
    "${Dsieve_schelp_files}"
    "${Dsieve_sctest_files}"
)

set(Tsieve_cpp_files
    plugins/Tsieve/Tsieve.cpp
)
set(Tsieve_sc_files
    plugins/Tsieve/sc/Tsieve.sc
)
set(Tsieve_sctest_files
    plugins/Tsieve/sc/Tests/TestTsieve.sc
)
set(Tsieve_schelp_files
    plugins/Tsieve/sc/HelpSource/Classes/Tsieve.schelp
)
sc_add_server_plugin(
    "f0plugins/Tsieve" # destination directory
    "Tsieve" # target name
    "${Tsieve_cpp_files}"
    "${Tsieve_sc_files}"
    "${Tsieve_schelp_files}"
    "${Tsieve_sctest_files}"
)

####################################################################################################
# END PLUGIN TARGET DEFINITION
####################################################################################################

message(STATUS "Generating plugin targets done")
